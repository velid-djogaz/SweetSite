"use strict";var _express=_interopRequireDefault(require("express")),_nodeFetch=_interopRequireDefault(require("node-fetch")),_cors=_interopRequireDefault(require("cors"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}require("dotenv/config");var _process$env=process.env,CLIENT_ID=_process$env.CLIENT_ID,APP_SECRET=_process$env.APP_SECRET,app=(0,_express.default)(),base="https://api-m.sandbox.paypal.com";app.use((0,_cors.default)({origin:"*"}));var generateAccessToken=function(){var r,t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=Buffer.from(CLIENT_ID+":"+APP_SECRET).toString("base64"),e.next=4,regeneratorRuntime.awrap((0,_nodeFetch.default)("".concat(base,"/v1/oauth2/token"),{method:"post",body:"grant_type=client_credentials",headers:{Authorization:"Basic ".concat(r)}}));case 4:return t=e.sent,e.next=7,regeneratorRuntime.awrap(t.json());case 7:return n=e.sent,e.abrupt("return",n.access_token);case 11:e.prev=11,e.t0=e.catch(0),console.error("Failed to generate Access Token:",e.t0);case 14:case"end":return e.stop()}},null,null,[[0,11]])},createOrder=function(){var r,t,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(generateAccessToken());case 2:return r=e.sent,t="".concat(base,"/v2/checkout/orders"),n={intent:"CAPTURE",purchase_units:[{amount:{currency_code:"USD",value:"0.02"}}]},e.next=7,regeneratorRuntime.awrap((0,_nodeFetch.default)(t,{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r,"∫")},method:"POST",body:JSON.stringify(n)}));case 7:return a=e.sent,e.abrupt("return",handleResponse(a));case 9:case"end":return e.stop()}})},capturePayment=function(){var r,t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(generateAccessToken());case 2:return r=e.sent,t="".concat(base,"/v2/checkout/orders/${orderID}/capture"),e.next=6,regeneratorRuntime.awrap((0,_nodeFetch.default)(t,{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r,"∫")}}));case 6:return n=e.sent,e.abrupt("return",handleResponse(n));case 8:case"end":return e.stop()}})};function handleResponse(r){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(200===r.status||201===r.status)return e.abrupt("return",r.json());e.next=2;break;case 2:return e.next=4,regeneratorRuntime.awrap(r.text());case 4:throw t=e.sent,new Error(t);case 6:case"end":return e.stop()}})}app.post("/orders",function(e,r){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(createOrder());case 3:t=e.sent,r.json(t),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to create order:",e.t0),r.status(500).json({error:"Failed to create order."});case 11:case"end":return e.stop()}},null,null,[[0,7]])}),app.post("/orders/:orderID/capture",function(r,t){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.params.orderID,e.next=4,regeneratorRuntime.awrap(capturePayment(n));case 4:a=e.sent,t.json(a),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Failed to create order:",e.t0),t.status(500).json({error:"Failed to capture order."});case 12:case"end":return e.stop()}},null,null,[[0,8]])}),app.listen(9597,function(){console.log("listening on http://localhost:9597/")});
//# sourceMappingURL=paypal.min.js.map
